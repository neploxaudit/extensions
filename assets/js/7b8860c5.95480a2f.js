"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[870],{6589:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>r,contentTitle:()=>a,default:()=>d,frontMatter:()=>c,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"Attacks/Clickjacking","title":"Clickjacking","description":"This chapter is dedicated to Clickjacking in extension windows. I think it is unnecessary to explain what Clickjacking is; if you don\'t know, you can read about it in this article. Here, we will consider the specifics of Clickjacking for extensions.","source":"@site/docs/Attacks/Clickjacking.mdx","sourceDirName":"Attacks","slug":"/Attacks/Clickjacking","permalink":"/Attacks/Clickjacking","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4},"sidebar":"tutorialSidebar","previous":{"title":"Open Closed Shadow DOM","permalink":"/Attacks/Shadow"},"next":{"title":"Unsafe storage to UXSS","permalink":"/Attacks/Storage to UXSS"}}');var s=i(4848),o=i(8453);const c={sidebar_position:4},a="Clickjacking",r={},l=[{value:"history.back()",id:"historyback",level:2}];function h(e){const n={a:"a",admonition:"admonition",code:"code",del:"del",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"clickjacking",children:"Clickjacking"})}),"\n",(0,s.jsxs)(n.p,{children:["This chapter is dedicated to Clickjacking in extension windows. I think it is unnecessary to explain what Clickjacking is; if you don't know, you can read about it in this ",(0,s.jsx)(n.a,{href:"https://aszx87410.github.io/beyond-xss/en/ch5/clickjacking/",children:"article"}),". Here, we will consider the specifics of Clickjacking for extensions."]}),"\n",(0,s.jsxs)(n.h1,{id:"x-frame-options-web_accessible_resources",children:[(0,s.jsx)(n.del,{children:"X-Frame-Options"})," web_accessible_resources"]}),"\n",(0,s.jsxs)(n.p,{children:["In the world of web applications, the ability to open a site in an iframe is regulated by X-Frame-Options or the CSP rule ",(0,s.jsx)(n.code,{children:"frame-ancestors"}),". In the world of extensions, Chrome handles this with ",(0,s.jsx)(n.a,{href:"https://developer.chrome.com/docs/extensions/reference/manifest/web-accessible-resources",children:"web_accessible_resources"})," in the manifest:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-JSON",children:'    "web_accessible_resources": [ {\n        "matches": [ "http://*/*", "https://*/*" ],\n        "resources": [ "assets/example.js", "assets/test.js" ],\n        "use_dynamic_url": false\n     } ]\n'})}),"\n",(0,s.jsxs)(n.p,{children:["In fact, in the original situation, you cannot access an extension resource unless it is listed in ",(0,s.jsx)(n.code,{children:"web_accessible_resources"})," (This cannot be done either with ",(0,s.jsx)(n.code,{children:"fetch"}),", or with ",(0,s.jsx)(n.code,{children:"iframe"})," and ",(0,s.jsx)(n.code,{children:"window.open"}),")."]}),"\n",(0,s.jsx)(n.p,{children:"However, there is a very important feature; suppose we have an extension with the following manifest:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-JSON",children:'    "web_accessible_resources": [ {\n        "matches": [ "http://*/*", "https://*/*" ],\n        "resources": [ "assets/test.html" ],\n        "use_dynamic_url": false\n     } ]\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Based on this manifest, we can open the ",(0,s.jsx)(n.code,{children:"assets/test.html"})," page in an ",(0,s.jsx)(n.code,{children:"iframe"}),". However, suppose ",(0,s.jsx)(n.code,{children:"test.html"})," contains the following content:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-html",children:'<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>Slonser</title>\n    <script>\n        const redirect_param = new URLSearchParams(window.location.search).get(\'redirect\');\n        if (!new URL(redirect_param).origin != origin) {\n            window.location.href = redirect_param;\n        }\n    <\/script>\n</head>\n<body>\n    \n</body>\n</html>\n'})}),"\n",(0,s.jsx)(n.p,{children:"This code allows for a redirect to any extension page, and we will still have the link."}),"\n",(0,s.jsxs)(n.p,{children:["In simple terms, ",(0,s.jsx)(n.code,{children:"web_accessible_resources"})," only regulates the initial page opening of the extension; if it performs a redirect, we will continue to have access to the window."]}),"\n",(0,s.jsx)(n.admonition,{title:"Note",type:"tip",children:(0,s.jsx)(n.p,{children:"This is very important, as an Open Redirect on a window that does not provide benefits from Clickjacking can allow you to perform Clickjacking on a window with settings, cryptocurrency transfers, etc."})}),"\n",(0,s.jsx)(n.h2,{id:"historyback",children:"history.back()"}),"\n",(0,s.jsx)(n.p,{children:"Another good technique for obtaining a reference to the window is to redirect to your window! Suppose you managed to get the popup window of the extension to execute:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"window.open(YOUR_SITE)\n"})}),"\n",(0,s.jsx)(n.p,{children:"Then you will need to create 2 documents on your site:\n1.html:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-html",children:"<script>\nwindow.open('/2.html','_blank','location=yes,height=570,width=520,scrollbars=yes,status=yes')\nwindow.history.back()\n<\/script>\n"})}),"\n",(0,s.jsx)(n.p,{children:"2.html:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-html",children:'<script>\n    console.log("Now you have a reference to the extension window")\n<\/script>\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Now you have a link to the window (which allows you, for example, to send ",(0,s.jsx)(n.code,{children:"postMessage"})," to it), and you also have the ability to clickjacking."]}),"\n",(0,s.jsxs)(n.p,{children:["You can also watch this ",(0,s.jsx)(n.a,{href:"https://www.youtube.com/watch?v=HnI0w156rtw",children:"video"})," if you are not familiar with clickjacking, it well demonstrates the impact of clickjacking in extensions."]})]})}function d(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>c,x:()=>a});var t=i(6540);const s={},o=t.createContext(s);function c(e){const n=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);